generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Contrato {
  id                    Int                        @id @default(autoincrement())
  numero                String                     @unique
  nome                  String
  cliente               String
  dataInicio            DateTime
  dataFim               DateTime
  status                String
  createdAt             DateTime                   @default(now())
  centrosCusto          ContratosCentrosCusto[]
  funcionarios          Funcionario[]
  remanejamentosOrigem  SolicitacaoRemanejamento[] @relation("ContratoOrigem")
  remanejamentosDestino SolicitacaoRemanejamento[] @relation("ContratoDestino")
}

model CentroCusto {
  id                Int                     @id @default(autoincrement())
  num_centro_custo  String                  @unique
  nome_centro_custo String
  status            String
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  contratos         ContratosCentrosCusto[]
}

model ContratosCentrosCusto {
  id            Int         @id @default(autoincrement())
  contratoId    Int
  centroCustoId Int
  createdAt     DateTime    @default(now())
  contrato      Contrato    @relation(fields: [contratoId], references: [id], onDelete: Cascade)
  centroCusto   CentroCusto @relation(fields: [centroCustoId], references: [id], onDelete: Cascade)

  @@unique([contratoId, centroCustoId])
}

model Funcionario {
  id                        Int                        @id @default(autoincrement())
  matricula                 String                     @unique
  cpf                       String?
  nome                      String
  funcao                    String?
  rg                        String?
  orgaoEmissor              String?
  uf                        String?
  dataNascimento            DateTime?
  email                     String?
  telefone                  String?
  centroCusto               String?
  departamento              String?
  status                    String?
  statusPrestserv           String?
  emMigracao                Boolean                    @default(false)
  contratoId                Int?
  criadoEm                  DateTime                   @default(now())
  atualizadoEm              DateTime                   @updatedAt
  excluidoEm                DateTime?
  sispat                    String?
  contrato                  Contrato?                  @relation(fields: [contratoId], references: [id])
  remanejamentosFuncionario RemanejamentoFuncionario[]
  usuario                   Usuario?
}

model SolicitacaoRemanejamento {
  id                Int                        @id @default(autoincrement())
  tipo              String                     @default("REMANEJAMENTO")
  contratoOrigemId  Int?
  contratoDestinoId Int?
  justificativa     String?
  status            String                     @default("Pendente")
  prioridade        String                     @default("Normal")
  solicitadoPor     String
  analisadoPor      String?
  dataSolicitacao   DateTime                   @default(now())
  dataAnalise       DateTime?
  dataAprovacao     DateTime?
  dataConclusao     DateTime?
  observacoes       String?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  historico         HistoricoRemanejamento[]
  funcionarios      RemanejamentoFuncionario[]
  contratoOrigem    Contrato?                  @relation("ContratoOrigem", fields: [contratoOrigemId], references: [id])
  contratoDestino   Contrato?                  @relation("ContratoDestino", fields: [contratoDestinoId], references: [id])

  @@index([status])
  @@index([dataSolicitacao])
}

model RemanejamentoFuncionario {
  id                   String                   @id @default(cuid())
  solicitacaoId        Int
  funcionarioId        Int
  statusTarefas        String                   @default("APROVAR SOLICITAÇÃO")
  statusPrestserv      String                   @default("PENDENTE")
  statusFuncionario    String                   @default("SEM_CADASTRO")
  dataRascunhoCriado   DateTime?
  dataSubmetido        DateTime?
  dataResposta         DateTime?
  observacoesPrestserv String?
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
  historico            HistoricoRemanejamento[]
  funcionario          Funcionario              @relation(fields: [funcionarioId], references: [id])
  solicitacao          SolicitacaoRemanejamento @relation(fields: [solicitacaoId], references: [id], onDelete: Cascade)
  tarefas              TarefaRemanejamento[]

  @@unique([solicitacaoId, funcionarioId])
  @@index([statusTarefas])
  @@index([statusPrestserv])
}

model TarefaRemanejamento {
  id                         String                          @id @default(cuid())
  remanejamentoFuncionarioId String
  tipo                       String
  descricao                  String?
  responsavel                String
  status                     String                          @default("PENDENTE")
  prioridade                 String                          @default("Normal")
  dataCriacao                DateTime                        @default(now())
  dataLimite                 DateTime?
  dataConclusao              DateTime?
  observacoes                String?
  dataVencimento             DateTime?
  historico                  HistoricoRemanejamento[]
  observacoesTarefa          ObservacaoTarefaRemanejamento[]
  remanejamentoFuncionario   RemanejamentoFuncionario        @relation(fields: [remanejamentoFuncionarioId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([responsavel])
}

model ObservacaoTarefaRemanejamento {
  id              Int                 @id @default(autoincrement())
  tarefaId        String
  texto           String
  dataCriacao     DateTime            @default(now())
  dataModificacao DateTime            @updatedAt
  criadoPor       String
  modificadoPor   String
  tarefa          TarefaRemanejamento @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
}

model HistoricoRemanejamento {
  id                         Int                       @id @default(autoincrement())
  remanejamentoFuncionarioId String?
  solicitacaoId              Int?
  tarefaId                   String?
  tipoAcao                   String
  entidade                   String
  campoAlterado              String?
  valorAnterior              String?
  valorNovo                  String?
  descricaoAcao              String
  usuarioResponsavel         String
  dataAcao                   DateTime                  @default(now())
  observacoes                String?
  remanejamentoFuncionario   RemanejamentoFuncionario? @relation(fields: [remanejamentoFuncionarioId], references: [id], onDelete: Cascade)
  solicitacao                SolicitacaoRemanejamento? @relation(fields: [solicitacaoId], references: [id], onDelete: Cascade)
  tarefa                     TarefaRemanejamento?      @relation(fields: [tarefaId], references: [id], onDelete: Cascade)

  @@index([dataAcao])
  @@index([tipoAcao])
  @@index([entidade])
  @@index([usuarioResponsavel])
  @@index([tarefaId])
}

model Equipe {
  id        Int       @id @default(autoincrement())
  nome      String    @unique
  descricao String?
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  usuarios  Usuario[]
}

model TarefaPadrao {
  id        Int      @id @default(autoincrement())
  setor     String
  tipo      String
  descricao String
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([setor])
  @@index([ativo])
}

model Usuario {
  id            Int         @id @default(autoincrement())
  funcionarioId Int         @unique
  senha         String
  equipeId      Int
  ativo         Boolean     @default(true)
  ultimoLogin   DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  funcionario   Funcionario @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)
  equipe        Equipe      @relation(fields: [equipeId], references: [id])

  @@index([funcionarioId])
  @@index([equipeId])
  @@index([ativo])
}
